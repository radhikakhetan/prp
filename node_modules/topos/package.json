{
  "name": "topos",
  "version": "0.3.10",
  "description": "Topo module for Node.js",
  "main": "index.js",
  "author": {
    "name": "Sanjeev Koranga"
  },
  "contributors": [
    {}
  ],
  "repository": {
    "type": "git",
    "url": "http://github.paypal.com/NodeInfra/node-topos.git"
  },
  "bin": {
    "toposbuild": "./scripts/topobuild.js",
    "prebuild": "./scripts/prebuild.js",
    "postbuild": "./scripts/postbuild.js"
  },
  "scripts": {
    "postinstall": "node ./postinstall.js"
  },
  "publishConfig": {
    "registry": "http://npm.paypal.com"
  },
  "keywords": [
    "topos",
    "nodejs",
    "config"
  ],
  "license": "MIT",
  "readmeFilename": "README.md",
  "dependencies": {
    "shelljs": "~0.5",
    "async": "^1",
    "curlnsave": "~0.1",
    "extend": "~3.0",
    "properties": "~1.2",
    "easy-table": "~1.0.0",
    "colors": "~1.1.0",
    "try-require": "^1.0.0",
    "environment-paypal": "^1.0.0",
    "connection-tester": "~0.1.0",
    "js-yaml": "~3.3.0",
    "valid-url": "~1.0.5"
  },
  "devDependencies": {
    "mocha": "^2",
    "jshint": "^2",
    "nconf": "~0.6.8",
    "fs-extra": "~0.23",
    "chai": "^2"
  },
  "readme": "node-topos\n==========\n\nTopos module for Node.js. This module resolves the connection end points for paypal internal services.\n\n- LIVE\n    - topo package\n- Stage\n    - topo package only\n    - topo package + stage override\n- DEV\n    - stage host + topo.main and portmap.topo from https://github.paypal.com/Topology/topo\n\n### Internals\n\nLayoutJSON aggregator will be part of npm postinstall, which will scan for all the layout.json files and aggregate them to final layout.json\n\n- Environment specific step\n    - For dev, uses topo:host (from config) + layout.json + topoMain.topo + PORTMAP.topo to generate the in memory layout.json\n    - For stage and live, run configurator on this layout.json and generate final layout.json.\n        - configurator take layout template file and service connection manifest file as input and output is layout.json. Full flow is layout_temp.json + service_manifest.json -> configurator -> layout.json\n\n- Uses nconf to store this layout.json as well. nconf acts as serviceLocator\n\n### For NodeApp developers\n\n#### To integrate topo functionality in your node app, follow these steps\n\n- Add topo dependency in package.json\n\n```javascript\n    \"dependencies\" : {\n        \"topos\" : \"~0.2.0\"\n    }\n```\n- Run npm install\n- If you are using not using brogan, Add the following code in index.js of KrakenJS Node app\n\nThe module (brogan)[https://github.paypal.com/NodeInfra/brogan] takes care of the below code for your app automatically. If you are not using brogan, add the follwing code.\n\n\n```javascript\nvar topos = require('topos');\n\napp.configure = function (nconf, next) {\n\n    topos.init(nconf.get('topos'), nconf);\n\n    ...\n    next(null, nconf);\n};\n```\n\n#### Devlopment Environment Overrides\n\n- By default topos package will resolve all the services for dev env from live.qa.paypal.com, but you can override this in development.json as\n\n```javascript\n{\n    \"topos\" : {\n        \"host\" : \"stage2lp37.qa.paypal.com\"\n    }\n}\n```\n\n#### Stage Environment Overrides\n\n- You can extend this topos:host (by moving the above config in config.json or staging.json) in stages as well and point to one specific stage for all your services. By this you can have your node app running in stageXXX and all the services in stageYYY.\n\nThis override will be completely Ignored in LIVE.\n\n\n#### How to define Service specific End points?\n\n##### Example 1: What if you would want to connect to StageABC for service ABC and StageDEF for service DEF and connect to managed stage \"live.qa.paypal.com\" for all the rest of the services.\n\nUse the Enviornment specific config files for service level overrides.\n\nFor example edit `development.json` for dev ENV and `staging.json` for Stage.\n\n```javascript\n{\n    \"services\" : {\n        \"ABC\" : {\n            \"hostname : \"stageABC.qa.paypal.com\"\n        },\n        \"DEF\" : {\n            \"hostname\" : \"stageDEF.qa.paypal.com\"\n        }\n    }\n}\n```\n\n##### Example 2: Let's say I want to override mayfly end point to test some new feature and stage2dev005.qa.paypal.com has these new changes.\n\n -  Copy the configuration from node_modules/connect-mayfly/node_modules/mayfly/layout.json (Mayfly dependency path) to staging.json.\n - Hardcode '\"ipport\" : \"%{mayfly-session_service}\"' to '\"ipport\" : \"1:stage2dev005.qa.paypal.com:10368\"'\n - Now on restart, mayfly will point to stage2dev005 while all the other services (using topo) will point to the default stage (live.qa.paypal.com).\n\n```javascript\n{\n    \"mayfly\": {\n        \"ipport\": \"1:stage2dev005.qa.paypal.com:10368\"\n    }\n}\n```\n\n##### Example 3: What if you would want to connect to StageABC for service ABC and connect to \"stage2dev005.qa.paypal.com\" for all the rest of the services (not managed stage).\n\nAdd the follwing sections to the ENV specific config file (Lets say `satging.json`):\n\n\n```javascript\n{\n    \"services\" : {\n        \"ABC\" : {\n            \"hostname : \"stageABC.qa.paypal.com\"\n        }\n    }\n}\n```\n\n```javascript\n{\n    \"topos\" : {\n        \"host\" : \"stage2dev005.qa.paypal.com\"\n    }\n}\n```\n\n#### How to check the details of the Resolved Endpoints?\n\n- You can also check the resolved topo endpoints in your app by\n\n```javascript\nconsole.log(topos.getDump());\n```\n\n#### How to check the status of the Resolved Endpoint connections (Dev and Stage)\n\n- You can check the status of topo connections\n\n```javascript\ntopos.connectionStatus(function(err, data){\n    console.log(data);\n});\n```\n\nBy default, topo module will run the connection check against all the topo service endpoints in dev and stage.\n\n##### Disable connection check\n- By default topos will run the connection check in dev environment, but for some reason if you don't want it, you can disable it by adding the following configuration.\n\n```javascript\n{\n    \"topos\" : {\n        \"connectionCheck\": \"disable\"\n    }\n}\n```\n\n##### Change connection check timeout\n- By default the connection check timeout is set to 1500ms, if you have latency issues and need a consistent status results for the connection tests, you can increase the timeout(ms). In any scenario, if you need the test the connections synchronously, add the 'syncCheck:true'.\n\nNote: The below settings are optional.\n\n```javascript\n{\n    \"topos\" : {\n        \"connectionCheckTimeout\": 4000,\n        \"syncCheck\": true\n    }\n}\n```\n\n### For module authors\n\nIf your module depends on TOPO, you need to create a layout.json file at the same level as package.json\n\nsomething like\n\n```javascript\nmymodule\n    |...\n    |...\n    |__ index.js\n    |\n    |__ layout.json  ## This file\n    |\n    |__ package.json\n```\n\n- If you are using the `Service Core` Module as the service invocation library, `Servicecore` module will read your module configurations from either the layout.json or the config files based on the environment. Please make sure that you are registering/creating the Service core instance uisng th exact same name as your module.\n\n\nElse, Have a peerDependency on nconf and get the module topo configuration directly from nconf inside your module.\n\n```javascript\n    var nconfig = nconf.get('mymodule');\n    ...\n```\n\n#### Example\n\n##### format with root\n\nThis is useful to group layouts under one root.\n\n```javascript\nlayout.json (mymodule)\n{\n    \"root\": \"services\",\n    \"layout\": {\n        \"host\": \"%{mymodule_serv_host}\",\n        \"port\": \"%{mymodule_serv_port}\"\n    }\n}\n```\n\n```javascript\n    servicecore.register('mymodule', require('mymodule'));\n\n\n    servicecore.create('mymodule', {  });\n```\n\nOR\n\n```javascript\nvar nconf = require('nconf');   //peerDependency\n\nfunction MyModule(config) {\n\n    ...\n\n    var nconfig = nconf.get('services:mymodule');        //comes from layout.json or config overrides, 'mymodule' is the name in package.json and 'services' is the root\n    console.log(nconfig.host, nconfig.port);\n}\n```\n\n##### simple format\n\n```javascript\nlayout.json (mymodule)\n{\n    \"host\" : \"%{mymodule_serv_host}\",\n    \"port\" : \"%{mymodule_serv_port}\"\n}\n```\n\n```javascript\nvar nconf = require('nconf');    //peerDependency\n\nfunction MyModule(config) {\n\n    ...\n\n    var nconfig = nconf.get('mymodule');        //comes from layout.json or config overrides, 'mymodule' is the name in package.json\n    console.log(nconfig.host, nconfig.port);\n}\n```\n\n##### ipport format\n\nIf service endpoint is following the netstring format `<priority>:<qualified host name or ip>:<port>[^<priority>:<qualified host name or ip>:<port>]`, use `ipport` in layout.json to express it. Topo module will normalize it to host/hostname and port.\n\n```javascript\nlayout.json (mymodule)\n{\n    \"ipport\" : \"%{mymodule_serv}\"\n}\n```\n\n```javascript\nvar nconf = require('nconf');    //peerDependency\n\nfunction MyModule(config) {\n\n    ...\n\n    var nconfig = nconf.get('mymodule');        //comes from layout.json, 'mymodule' is the name in package.json\n    console.log(nconfig.host, nconfig.port);\n}\n```\n\n##### url format\n\nIf service has direct url, use `url` in layout.json to express it. Topo module will normalize it to host/hostname and port.\n\n```javascript\nlayout.json (mymodule)\n{\n    \"url\" : \"%{mymodule_serv_url}\"\n}\n```\n\n\n### PortMap\n\nSince topo module maintain a map of all the service-ports in STAGE environment. You can access it as\n\n```js\n    topos.getAllEndPoints()             //Map of all service-ports\n    topos.getPort(serviceName)          //return the stage2 port for a service\n```\n",
  "_id": "topos@0.3.10",
  "_shasum": "bc2dbe5b7f745a05e33510db96c22de92c0760c5",
  "_from": "topos@>=0.3.6",
  "_resolved": "http://npm.paypal.com/topos/-/topos-0.3.10.tgz"
}
