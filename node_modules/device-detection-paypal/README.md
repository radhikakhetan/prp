device-detection-paypal
===================

A server side utility (written as express middleware) to detect information of the client device based on the userAgent header of incoming request.

### Usage

```javascript
	npm install device-detection-paypal
```

#### As Middleware

To use Device detection as a Middleware add the following line:

```javascript
	app.use(require('device-detection-paypal').middleware());
```

**Note**: `brogan`/`paypalize` does this middleware registration automatically.


This middleware will set the `deviceInfo` to the request Object.

```javascript
	console.log(req.deviceInfo);
```

#### As a module

To use the device detection module directly, pass the user-agent string as input.
```javascript
	require('device-detection-paypal').getDeviceInfo("user agent string", callback);
```

### Device Detection Service

Refer to [devicedetectionservice](https://github.paypal.com/FrameworksServicesAndTools-R/devicedetectionservice) for service details.

##### Service Response

| Property Name     | Type      | Description       
|-------------      |-----------|-------------
| browser           | String    | Browser Name, `Safari Webkit, Firefox Gecko etc `
| browserVersion    | String    | "4.0.4" - Safari Web Kit 4.X
| cpu               | String    | Cpu information about the device
| deviceOS          | String    | Operating System for the device , iOS, Android etc.
| displayHeight     | Integer   | ViewPort max, height avaialble for the Device
| displayWidth      | Integer   | ViewPort max, width avaialble for the Device
| displayWidth      | Integer   | ViewPort max, width avaialble for the Device
| isCookie          | Boolean   | Is Cookie Supported on the Browser / Device
| isDesktop         | Boolean   | Is the incomming request is Desktop
| isHTTPS           | Boolean   | Is HTTPS supported
| isJS              | Boolean   | Is Javascript Supported
| isLocalStorage    | Boolean   | Is Local Storage Supported
| isSessionStorage  | Boolean   | Is Session Storage Supported
| isSessionStorage  | Boolean   | Is Session Storage Supported
| isSvg             | Boolean   | SVG Supported on the Device
| isMobile          | Boolean   | Is the request from mobile (only the mobile devices, iPads would return false)
| isTablet          | Boolean   | Is the request from tablet
| isTouchScreen     | Boolean   | Is the requested device have touch feature, (Mobile, Tablets should return true)
| isWebSockets      | Boolean   | Is the requested device have support for WebSockets
| memory            | String    | Maximum memory available for the device
| osName            | String    | Operating System for the Device
| osVersion         | String    | Operating System version for the Device
| screenHeight      | Integer   | Max screen height for the device
| screenWidth       | Integer   | Max screen height for the device

==

### DeviceProperties
<a id="deviceproperties"></a>
#### Following Properties Applicable for Devices(mobile / tablets) Only Object

|Properties
|-------------  
| cpu           
| deviceOS      
| displayHeight
| displayWidth  
| displayWidth  
| memory        
| osName        
| osVersion     
| screenHeight  
| screenWidth   
| isTouchScreen


#### Sample Response

```javascript
	{
		screenHeight: 0,
		isCookie: false,
		osVersion: '',
		browserVersion: '',
		isTouchScreen: false,
		isGeoLocation: false,
		cpu: '',
		isJS: false,
		isWebSockets: false,
		displayWidth: 0,
		isLocalStorage: false,
		memory: '',
		displayHeight: 0,
		deviceOSVersion: '',
		screenWidth: 0,
		isHTTPS: false,
		isTablet: false,
		browser: '',
		isDesktop: true,
		isSessionStorage: false,
		isSvg: false,
		isMobile: false,
		osName: '',
		deviceOS: 'OTHER'
	}

```
### Fallback

If the Device detection service API endpoint fails, this module uses the (express-useragent) [https://github.com/biggora/express-useragent] parser module to find out basic properties.

To distinguish the Response from fallback - the property `fallback` will be set to true.

Following are the properties set by the fallback

`isTouchScreen` , `isTV`, `isTablet`, `isMobile`, `isRobot`, `osName`, `browserVersion`, `isDesktop`, `browser` and `fallback`

#### `forceFallback`
If needed, one can force device-detection-paypal to always use the fallback (for example, for mocking when running tests). This can be achieved by using `forceFallback`.
When using the middleware:
```javascript
	app.use(require('device-detection-paypal').middleware({ forceFallback: true }));
```
When using as a module
```javascript
	require('device-detection-paypal').getDeviceInfo("user agent string", { forceFallback: true }, callback);
```

### Optimization
To optimize and avoid making the same servicecall again and again, the service response is getting cached in user session.
